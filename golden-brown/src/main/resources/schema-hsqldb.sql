-- Clean database

DROP TABLE MULTIPLESURIS IF EXISTS;
DROP TABLE CLICK IF EXISTS;
DROP TABLE SHORTURL IF EXISTS;
DROP TABLE USERS IF EXISTS;
DROP TABLE AUTHORITIES IF EXISTS;

-- ShortURL

CREATE TABLE SHORTURL(
	HASH		VARCHAR(30) PRIMARY KEY,	-- Key
	TARGET		VARCHAR(1024),				-- Original URL
	SPONSOR		VARCHAR(1024),				-- Sponsor URL
	CREATED 	TIMESTAMP,					-- Creation date
	OWNER		VARCHAR(255),				-- User id
	MODE		INTEGER,					-- Redirect mode
	SAFE		BOOLEAN,					-- Safe target
	IP			VARCHAR(20),				-- IP
	COUNTRY		VARCHAR(50),				-- Country
	USERNAME	VARCHAR(45)					-- Username
);

-- Click

CREATE TABLE CLICK(
    ID 			BIGINT IDENTITY PRIMARY KEY, -- Key
	HASH 		VARCHAR(10) NOT NULL FOREIGN KEY REFERENCES SHORTURL(HASH),	-- Foreing key	
	CREATED 	TIMESTAMP,					-- Creation date
	REFERRER	VARCHAR(1024),				-- Traffic origin
	BROWSER		VARCHAR(50),				-- Browser
	PLATFORM	VARCHAR(50),				-- Platform
	IP			VARCHAR(20),				-- IP
	COUNTRY		VARCHAR(50)					-- Country
);

-- Usuario

CREATE TABLE USERS(
	USERNAME	VARCHAR(45) NOT NULL PRIMARY KEY,	-- Key
	NICK		VARCHAR(45) NOT NULL,				-- Nick
	PASSWORD	VARCHAR(45) NOT NULL,				-- Contraseña
	ENABLED		BOOLEAN NOT NULL
);

CREATE TABLE AUTHORITIES(
    USERNAME	VARCHAR(45) NOT NULL,				-- Key
    AUTHORITY	VARCHAR(45) NOT NULL,				-- Autoridad
    CONSTRAINT FK_AUTHORITIES_USERS FOREIGN KEY(USERNAME) REFERENCES USERS(USERNAME)
);

CREATE UNIQUE INDEX IX_AUTH_USERNAME ON AUTHORITIES(USERNAME, AUTHORITY);

-- MULTIPLESURIS

CREATE TABLE MULTIPLESURIS(
	URI		VARCHAR(30) PRIMARY KEY,					-- Key
	TARGET	VARCHAR(1024) FOREIGN KEY REFERENCES SHORTURL(HASH) -- Original URL
);